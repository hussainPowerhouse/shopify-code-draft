<div class="ratio-chart-main">
    <div class="page-width">
        <div class="gold-container">
            <h2 id="live-chart-title" data-live-price="">{{ section.settings.tit }}</h2>

        </div>
        <div id="ratio-chart" style="width: 100%; height: 500px;"></div>
    </div>
</div>
<style>
    .ratio-chart-main {
        margin: 80px 0px;
    }

    @mediaonlyscreen and (max-width: 992px) {
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        let ratioChart;

        // Function to create the ratio chart
        async function createRatioChart() {
            // Using amCharts to create the chart
            am4core.useTheme(am4themes_animated);
            ratioChart = am4core.create("ratio-chart", am4charts.XYChart);

            // Set up axes
            let dateAxis = ratioChart.xAxes.push(new am4charts.DateAxis());
            dateAxis.renderer.minGridDistance = 50;
            dateAxis.dateFormats.setKey("hour", "HH:mm"); // Remove 'UTC' from the format
            dateAxis.tooltipDateFormat = "HH:mm, d MMMM"; // Remove 'UTC' from the tooltip format
            dateAxis.renderer.labels.template.fill = am4core.color(
                "#FFFFFF"); // Change label color to white
            dateAxis.renderer.grid.template.stroke = am4core.color("#FFFFFF"); // Change grid color to white
            dateAxis.title.fill = am4core.color("#FFFFFF"); // Change x-axis title color to white

            // Adjust label padding and spacing on X-axis
            dateAxis.renderer.labels.template.paddingTop = 10; // Add padding for more spacing
            dateAxis.renderer.minLabelPosition = 0.01; // Adjust label positioning if necessary
            dateAxis.renderer.maxLabelPosition = 0.99;

            let valueAxis = ratioChart.yAxes.push(new am4charts.ValueAxis());
            valueAxis.title.text = "Gold to Silver Ratio";
            valueAxis.renderer.labels.template.fill = am4core.color(
                "#FFFFFF"); // Change label color to white
            valueAxis.renderer.grid.template.stroke = am4core.color(
                "#FFFFFF"); // Change grid color to white
            valueAxis.title.fill = am4core.color("#FFFFFF"); // Change y-axis title color to white

            // Create series
            let series = ratioChart.series.push(new am4charts.LineSeries());
            series.dataFields.valueY = "value";
            series.dataFields.dateX = "date";
            series.tooltipText = "Ratio: {value}";
            series.stroke = am4core.color("silver");
            series.fill = am4core.color("silver");
            series.strokeWidth = 2;
            series.minBulletDistance = 10;

            ratioChart.cursor = new am4charts.XYCursor();
            ratioChart.cursor.xAxis = dateAxis;

            // Optional: Change the background of the chart to transparent
            ratioChart.background.fill = am4core.color("#00000000");





            // Fetch data and populate the chart
            await updateRatioChartData();
        }

        // Function to fetch and update the ratio chart data
        async function updateRatioChartData() {
            try {
                // let response = await fetch('https://www.apmex.com/spotprice/getmetaltometalratiochart?metalIDNumerator=1&metalIDDenominator=2&type=1D&_=1726239776376');
                let response = await fetch(
                    'https://infinite-beach-29082-7875b8bd1777.herokuapp.com/api/ratio-chart');
                let apiData = await response.json();
                //         let apiData={
                // "chartdata": [
                // [
                // 1726136160000,
                // 85.8
                // ],
                // [
                // 1726136520000,
                // 85.94
                // ],
                // [
                // 1726136940000,
                // 85.9
                // ],
                // [
                // 1726137300000,
                // 85.92
                // ],
                // [
                // 1726137720000,
                // 85.9
                // ],
                // [
                // 1726138080000,
                // 85.91
                // ],
                // [
                // 1726138500000,
                // 85.84
                // ],
                // [
                // 1726138860000,
                // 85.77
                // ],
                // [
                // 1726139280000,
                // 85.57
                // ],
                // [
                // 1726139640000,
                // 85.68
                // ],
                // [
                // 1726140060000,
                // 85.54
                // ],
                // [
                // 1726140420000,
                // 85.51
                // ],
                // [
                // 1726140840000,
                // 85.56
                // ],
                // [
                // 1726141200000,
                // 85.54
                // ],
                // [
                // 1726141620000,
                // 85.5
                // ],
                // [
                // 1726141980000,
                // 85.43
                // ],
                // [
                // 1726142400000,
                // 85.47
                // ],
                // [
                // 1726142760000,
                // 85.39
                // ],
                // [
                // 1726143180000,
                // 85.51
                // ],
                // [
                // 1726143540000,
                // 85.5
                // ],
                // [
                // 1726143960000,
                // 85.48
                // ],
                // [
                // 1726144320000,
                // 85.59
                // ],
                // [
                // 1726144740000,
                // 85.62
                // ],
                // [
                // 1726145100000,
                // 85.58
                // ],
                // [
                // 1726145520000,
                // 85.61
                // ],
                // [
                // 1726145880000,
                // 85.58
                // ],
                // [
                // 1726146300000,
                // 85.51
                // ],
                // [
                // 1726146660000,
                // 85.57
                // ],
                // [
                // 1726147080000,
                // 85.59
                // ],
                // [
                // 1726147440000,
                // 85.61
                // ],
                // [
                // 1726147860000,
                // 85.53
                // ],
                // [
                // 1726148220000,
                // 85.52
                // ],
                // [
                // 1726148640000,
                // 85.56
                // ],
                // [
                // 1726149000000,
                // 85.61
                // ],
                // [
                // 1726149420000,
                // 85.73
                // ],
                // [
                // 1726149780000,
                // 85.65
                // ],
                // [
                // 1726150200000,
                // 85.56
                // ],
                // [
                // 1726150560000,
                // 85.59
                // ],
                // [
                // 1726150980000,
                // 85.65
                // ],
                // [
                // 1726151340000,
                // 85.6
                // ],
                // [
                // 1726151760000,
                // 85.51
                // ],
                // [
                // 1726152120000,
                // 85.51
                // ],
                // [
                // 1726152540000,
                // 85.37
                // ],
                // [
                // 1726152900000,
                // 85.46
                // ],
                // [
                // 1726153320000,
                // 85.45
                // ],
                // [
                // 1726153680000,
                // 85.47
                // ],
                // [
                // 1726154100000,
                // 85.51
                // ],
                // [
                // 1726154460000,
                // 85.51
                // ],
                // [
                // 1726154880000,
                // 85.43
                // ],
                // [
                // 1726155240000,
                // 85.44
                // ],
                // [
                // 1726155660000,
                // 85.39
                // ],
                // [
                // 1726156020000,
                // 85.42
                // ],
                // [
                // 1726156440000,
                // 85.41
                // ],
                // [
                // 1726160400000,
                // 85.39
                // ],
                // [
                // 1726160820000,
                // 85.37
                // ],
                // [
                // 1726161180000,
                // 85.4
                // ],
                // [
                // 1726161600000,
                // 85.36
                // ],
                // [
                // 1726161960000,
                // 85.35
                // ],
                // [
                // 1726162380000,
                // 85.34
                // ],
                // [
                // 1726162740000,
                // 85.28
                // ],
                // [
                // 1726163160000,
                // 85.27
                // ],
                // [
                // 1726163520000,
                // 85.31
                // ],
                // [
                // 1726163940000,
                // 85.35
                // ],
                // [
                // 1726164300000,
                // 85.37
                // ],
                // [
                // 1726164720000,
                // 85.35
                // ],
                // [
                // 1726165080000,
                // 85.4
                // ],
                // [
                // 1726165500000,
                // 85.38
                // ],
                // [
                // 1726165860000,
                // 85.37
                // ],
                // [
                // 1726166280000,
                // 85.39
                // ],
                // [
                // 1726166640000,
                // 85.41
                // ],
                // [
                // 1726167060000,
                // 85.36
                // ],
                // [
                // 1726167420000,
                // 85.45
                // ],
                // [
                // 1726167840000,
                // 85.34
                // ],
                // [
                // 1726168200000,
                // 85.32
                // ],
                // [
                // 1726168620000,
                // 85.24
                // ],
                // [
                // 1726168980000,
                // 85.27
                // ],
                // [
                // 1726169400000,
                // 85.28
                // ],
                // [
                // 1726169760000,
                // 85.27
                // ],
                // [
                // 1726170180000,
                // 85.28
                // ],
                // [
                // 1726170540000,
                // 85.29
                // ],
                // [
                // 1726170960000,
                // 85.28
                // ],
                // [
                // 1726171320000,
                // 85.31
                // ],
                // [
                // 1726171740000,
                // 85.29
                // ],
                // [
                // 1726172100000,
                // 85.37
                // ],
                // [
                // 1726172520000,
                // 85.38
                // ],
                // [
                // 1726172880000,
                // 85.37
                // ],
                // [
                // 1726173300000,
                // 85.35
                // ],
                // [
                // 1726173660000,
                // 85.29
                // ],
                // [
                // 1726174080000,
                // 85.45
                // ],
                // [
                // 1726174440000,
                // 85.39
                // ],
                // [
                // 1726174860000,
                // 85.33
                // ],
                // [
                // 1726175220000,
                // 85.35
                // ],
                // [
                // 1726175640000,
                // 85.34
                // ],
                // [
                // 1726176000000,
                // 85.35
                // ],
                // [
                // 1726176420000,
                // 85.36
                // ],
                // [
                // 1726176780000,
                // 85.42
                // ],
                // [
                // 1726177200000,
                // 85.43
                // ],
                // [
                // 1726177560000,
                // 85.37
                // ],
                // [
                // 1726177980000,
                // 85.38
                // ],
                // [
                // 1726178340000,
                // 85.39
                // ],
                // [
                // 1726178760000,
                // 85.33
                // ],
                // [
                // 1726179120000,
                // 85.38
                // ],
                // [
                // 1726179540000,
                // 85.4
                // ],
                // [
                // 1726179900000,
                // 85.45
                // ],
                // [
                // 1726180320000,
                // 85.4
                // ],
                // [
                // 1726180680000,
                // 85.4
                // ],
                // [
                // 1726181100000,
                // 85.47
                // ],
                // [
                // 1726181460000,
                // 85.49
                // ],
                // [
                // 1726181880000,
                // 85.53
                // ],
                // [
                // 1726182240000,
                // 85.56
                // ],
                // [
                // 1726182660000,
                // 85.56
                // ],
                // [
                // 1726183020000,
                // 85.52
                // ],
                // [
                // 1726183440000,
                // 85.54
                // ],
                // [
                // 1726183800000,
                // 85.52
                // ],
                // [
                // 1726184220000,
                // 85.5
                // ],
                // [
                // 1726184580000,
                // 85.49
                // ],
                // [
                // 1726185000000,
                // 85.43
                // ],
                // [
                // 1726185360000,
                // 85.46
                // ],
                // [
                // 1726185780000,
                // 85.44
                // ],
                // [
                // 1726186140000,
                // 85.41
                // ],
                // [
                // 1726186560000,
                // 85.41
                // ],
                // [
                // 1726186920000,
                // 85.3
                // ],
                // [
                // 1726187340000,
                // 85.27
                // ],
                // [
                // 1726187700000,
                // 85.16
                // ],
                // [
                // 1726188120000,
                // 85.24
                // ],
                // [
                // 1726188480000,
                // 85.29
                // ],
                // [
                // 1726188900000,
                // 85.4
                // ],
                // [
                // 1726189260000,
                // 85.53
                // ],
                // [
                // 1726189680000,
                // 85.57
                // ],
                // [
                // 1726190040000,
                // 85.52
                // ],
                // [
                // 1726190460000,
                // 85.55
                // ],
                // [
                // 1726190820000,
                // 85.44
                // ],
                // [
                // 1726191240000,
                // 85.4
                // ],
                // [
                // 1726191600000,
                // 85.3
                // ],
                // [
                // 1726192020000,
                // 85.18
                // ],
                // [
                // 1726192380000,
                // 85.22
                // ],
                // [
                // 1726192800000,
                // 85.23
                // ],
                // [
                // 1726193160000,
                // 85.2
                // ],
                // [
                // 1726193580000,
                // 85.2
                // ],
                // [
                // 1726193940000,
                // 85.16
                // ],
                // [
                // 1726194360000,
                // 85.18
                // ],
                // [
                // 1726194720000,
                // 85.18
                // ],
                // [
                // 1726195140000,
                // 85.2
                // ],
                // [
                // 1726195500000,
                // 85.11
                // ],
                // [
                // 1726195920000,
                // 85.23
                // ],
                // [
                // 1726196280000,
                // 85.22
                // ],
                // [
                // 1726196700000,
                // 85.18
                // ],
                // [
                // 1726197060000,
                // 85.22
                // ],
                // [
                // 1726197480000,
                // 85.15
                // ],
                // [
                // 1726197840000,
                // 85.11
                // ],
                // [
                // 1726198260000,
                // 85.13
                // ],
                // [
                // 1726198620000,
                // 85.07
                // ],
                // [
                // 1726199040000,
                // 85.08
                // ],
                // [
                // 1726199400000,
                // 85.05
                // ],
                // [
                // 1726199820000,
                // 85.05
                // ],
                // [
                // 1726200180000,
                // 85.01
                // ],
                // [
                // 1726200600000,
                // 85.06
                // ],
                // [
                // 1726200960000,
                // 85.08
                // ],
                // [
                // 1726201380000,
                // 85.05
                // ],
                // [
                // 1726201740000,
                // 85.03
                // ],
                // [
                // 1726202160000,
                // 85.08
                // ],
                // [
                // 1726202520000,
                // 85.1
                // ],
                // [
                // 1726202940000,
                // 85.11
                // ],
                // [
                // 1726203300000,
                // 85.17
                // ],
                // [
                // 1726203720000,
                // 85.26
                // ],
                // [
                // 1726204080000,
                // 85.19
                // ],
                // [
                // 1726204500000,
                // 85.25
                // ],
                // [
                // 1726204860000,
                // 85.17
                // ],
                // [
                // 1726205280000,
                // 85.17
                // ],
                // [
                // 1726205640000,
                // 85.17
                // ],
                // [
                // 1726206060000,
                // 85.14
                // ],
                // [
                // 1726206420000,
                // 85.2
                // ],
                // [
                // 1726206840000,
                // 85.3
                // ],
                // [
                // 1726207200000,
                // 85.29
                // ],
                // [
                // 1726207620000,
                // 85.34
                // ],
                // [
                // 1726207980000,
                // 85.36
                // ],
                // [
                // 1726208400000,
                // 85.31
                // ],
                // [
                // 1726208760000,
                // 85.38
                // ],
                // [
                // 1726209180000,
                // 85.31
                // ],
                // [
                // 1726209540000,
                // 85.38
                // ],
                // [
                // 1726209960000,
                // 85.27
                // ],
                // [
                // 1726210320000,
                // 85.18
                // ],
                // [
                // 1726210740000,
                // 85.2
                // ],
                // [
                // 1726211100000,
                // 85.14
                // ],
                // [
                // 1726211520000,
                // 85.11
                // ],
                // [
                // 1726211880000,
                // 85.1
                // ],
                // [
                // 1726212300000,
                // 85.14
                // ],
                // [
                // 1726212660000,
                // 85.17
                // ],
                // [
                // 1726213080000,
                // 85.21
                // ],
                // [
                // 1726213440000,
                // 85.11
                // ],
                // [
                // 1726213860000,
                // 85.04
                // ],
                // [
                // 1726214220000,
                // 85.15
                // ],
                // [
                // 1726214640000,
                // 85.09
                // ],
                // [
                // 1726215000000,
                // 84.63
                // ],
                // [
                // 1726215420000,
                // 84.49
                // ],
                // [
                // 1726215780000,
                // 84.26
                // ],
                // [
                // 1726216200000,
                // 84.29
                // ],
                // [
                // 1726216560000,
                // 83.93
                // ],
                // [
                // 1726216980000,
                // 83.95
                // ],
                // [
                // 1726217340000,
                // 83.94
                // ],
                // [
                // 1726217760000,
                // 84.14
                // ],
                // [
                // 1726218120000,
                // 84.13
                // ],
                // [
                // 1726218540000,
                // 84.16
                // ],
                // [
                // 1726218900000,
                // 83.86
                // ],
                // [
                // 1726219320000,
                // 83.83
                // ],
                // [
                // 1726219680000,
                // 83.94
                // ],
                // [
                // 1726220100000,
                // 84.02
                // ],
                // [
                // 1726220460000,
                // 83.98
                // ],
                // [
                // 1726220880000,
                // 84.01
                // ],
                // [
                // 1726221240000,
                // 84.1
                // ],
                // [
                // 1726221660000,
                // 84.07
                // ],
                // [
                // 1726222020000,
                // 84.47
                // ]
                // ],
                // "metalData": {
                // "low": 83.83,
                // "high": 85.94,
                // "change": -1.33,
                // "changePct": -1.55,
                // "metalChange": "red"
                // }
                // }
                //console.log('API Data:', apiData); // Log to check if data is fetched correctly

                if (apiData.items && apiData.items.length) {
                    let items = apiData.items.map(item => ({
                        date: new Date(item.timestamp), // Ensure the timestamp is correctly converted to Date
                        value: item.ratioValue // Ratio value
                    }));

                    //console.log('Processed Chart Data:', items); // Log the processed chart data

                    ratioChart.data = items; // Update chart data
                } else {
                    console.error('No data available from API');
                }
            } catch (error) {
                console.error('Error fetching ratio chart data:', error);
            }
        }

        // Initialize the ratio chart on page load
        createRatioChart();

        // Set 1-minute interval for updating the chart data
        setInterval(() => {
            updateRatioChartData(); // Update ratio chart data every minute
        }, 30000);
    });
</script>

{% schema %}
{
    "name": "Ratio Chart",
    "settings": [{
        "type": "text",
        "id": "tit",
        "label": "Title"
    }],
    "presets": [{
        "name": "Ratio Chart"
    }]
}
{% endschema %}
